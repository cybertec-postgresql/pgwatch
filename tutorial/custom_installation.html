
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="pgwatch is a flexible PostgreSQL-specific monitoring solution">
      
      
      
        <link rel="canonical" href="https://pgwat.ch/tutorial/custom_installation.html">
      
      
        <link rel="prev" href="docker_installation.html">
      
      
        <link rel="next" href="preparing_databases.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.29">
    
    
      
        <title>Custom installation - 🔬 pgwatch | v3</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.76a95c52.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview-of-installation-steps" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="🔬 pgwatch | v3" class="md-header__button md-logo" aria-label="🔬 pgwatch | v3" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            🔬 pgwatch | v3
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Custom installation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cybertec-postgresql/pgwatch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pgwatch by Cybertec
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../index.html" class="md-tabs__link">
          
  
  Intro

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../concept/components.html" class="md-tabs__link">
          
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="docker_installation.html" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../howto/using_managed_services.html" class="md-tabs__link">
          
  
  How To

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../reference/advanced_features.html" class="md-tabs__link">
          
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../gallery/dashboards.html" class="md-tabs__link">
          
  
  Gallery

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../developer/godoc.html" class="md-tabs__link">
          
  
  Developer

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="🔬 pgwatch | v3" class="md-nav__button md-logo" aria-label="🔬 pgwatch | v3" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    🔬 pgwatch | v3
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cybertec-postgresql/pgwatch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pgwatch by Cybertec
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Intro
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Intro
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello World!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/project_background.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Background
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/features.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concept/components.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concept/configuration_options.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concept/web_ui.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web UI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concept/dashboards.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dashboards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concept/long_term_installations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Long Term Installations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concept/sizing_recommendations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sizing Recommendations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concept/alerting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alerting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="docker_installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Custom Installation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="custom_installation.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Custom Installation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-of-installation-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of installation steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Install Postgres
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-pgwatch" class="md-nav__link">
    <span class="md-ellipsis">
      Install pgwatch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choose-your-configuration-method" class="md-nav__link">
    <span class="md-ellipsis">
      Choose your configuration method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Choose your configuration method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#boostrap-the-configuration-database" class="md-nav__link">
    <span class="md-ellipsis">
      Boostrap the configuration database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#init-yaml-configuration-files-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Init YAML configuration files (optional)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-the-measurements-storage-aka-postgres-sink" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap the measurements storage aka Postgres sink
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-to-be-monitored-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare the "to-be-monitored" sources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-sources-to-be-monitored-and-metrics-with-intervals" class="md-nav__link">
    <span class="md-ellipsis">
      Configure sources to be monitored and metrics with intervals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-pgwatch-metrics-collection-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Start the pgwatch metrics collection agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitor-the-console-or-log-output-for-any-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor the console or log output for any problems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      Install Grafana
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="preparing_databases.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparing Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="upgrading.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How To
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            How To
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howto/using_managed_services.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Managed Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howto/bootstrap-sink-postgres.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bootstrap PostgreSQL sink
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howto/bootstrap-sink-prometheus.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bootstrap Prometheus sink
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howto/build-pgwatch.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build pgwatch from source
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/advanced_features.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/metric_definitions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metric Definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/technical_details.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Technical Details
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/security.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/kubernetes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/env_variables.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environment Variables
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gallery
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Gallery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gallery/dashboards.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dashboards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gallery/webui.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web UI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Developer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/godoc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/contributing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/CODE_OF_CONDUCT.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/LICENSE.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-of-installation-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of installation steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Install Postgres
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-pgwatch" class="md-nav__link">
    <span class="md-ellipsis">
      Install pgwatch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choose-your-configuration-method" class="md-nav__link">
    <span class="md-ellipsis">
      Choose your configuration method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Choose your configuration method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#boostrap-the-configuration-database" class="md-nav__link">
    <span class="md-ellipsis">
      Boostrap the configuration database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#init-yaml-configuration-files-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Init YAML configuration files (optional)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-the-measurements-storage-aka-postgres-sink" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap the measurements storage aka Postgres sink
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-to-be-monitored-sources" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare the "to-be-monitored" sources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-sources-to-be-monitored-and-metrics-with-intervals" class="md-nav__link">
    <span class="md-ellipsis">
      Configure sources to be monitored and metrics with intervals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-pgwatch-metrics-collection-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Start the pgwatch metrics collection agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitor-the-console-or-log-output-for-any-problems" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor the console or log output for any problems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      Install Grafana
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/cybertec-postgresql/pgwatch/edit/master/docs/tutorial/custom_installation.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


  <h1>Custom Installation</h1>

<p>As described in the <a href="../concept/components.html">Components</a> 
chapter, there are couple of ways how to set up pgwatch.
Two most common ways though are the central <em>Configuration Database</em> 
approach and the <em>YAML file</em> based approach, plus Grafana to
visualize the gathered metrics.</p>
<h2 id="overview-of-installation-steps">Overview of installation steps</h2>
<ol>
<li>Install Postgres or use any available existing instance.
    Postgres newer than v11 is required but using the latest 
    official version is recommended.</li>
<li>Bootstrap the configuration database.</li>
<li>Bootstrap the sinks if needed, e.g. PostgreSQL database.</li>
<li>Install pgwatch either from pre-built packages or by compiling
    the Go code.</li>
<li>Prepare the "to-be-monitored" databases for monitoring by creating
    a dedicated login role with <code>pg_monitor</code> privileges.</li>
<li>Add some databases to the monitoring configuration via the Web UI, REST API or
    directly in the configuration database.</li>
<li>Start the pgwatch metrics collection agent and monitor the logs for
    any problems.</li>
<li>Install and configure Grafana and import the pgwatch sample
    dashboards to start analyzing the metrics.</li>
<li>Make sure that there are auto-start OS services for all
    components in place and optionally set up also backups.</li>
</ol>
<p>Below are the sample steps for a custom installation from scratch using
Postgres as a configuration database for all components:
    - for monitored sources, 
    - for metrics definitions,
    - and for Grafana configuration.</p>
<p>All examples here assume Ubuntu as OS, but it's basically the same for
RedHat family of operations systems also, minus package installation
syntax differences.</p>
<h2 id="install-postgres">Install Postgres</h2>
<p>Follow the standard Postgres <a href="https://www.postgresql.org/download/">install procedure</a> basically. 
Use the latest major version available, but minimally v11+ is required.</p>
<h2 id="install-pgwatch">Install pgwatch</h2>
<p>You can do it either from <a href="https://github.com/cybertec-postgresql/pgwatch/releases/">pre-built packages</a> or by
<a href="../howto/build-pgwatch.html">compiling the Go code</a>.</p>
<h2 id="choose-your-configuration-method">Choose your configuration method</h2>
<ul>
<li><strong>Centralized configuration database</strong> - the default and most
    common way. The configuration database holds all the
    information about monitored sources, metrics, and Grafana
    settings.</li>
<li><strong>YAML file based configuration</strong> - a more decentralized way
    where monitoring configuration is specified in YAML files. This
    is useful for setups where you want to keep the monitoring
    configuration separate from the pgwatch configuration database.</li>
<li><strong>Mixed model</strong> - you can also use a combination of both
    centralized and YAML based configuration, e.g. store metric definitions in a YAML file and monitored sources in the configuration database and vice versa.</li>
</ul>
<h3 id="boostrap-the-configuration-database">Boostrap the configuration database</h3>
<ol>
<li>
<p>Create a user to "own" the <code>pgwatch</code> schema. 
    Typically called <code>pgwatch</code> but can be anything really, if the schema creation file is adjusted accordingly.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">    </span>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;create user pgwatch password &#39;xyz&#39;&quot;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;create database pgwatch owner pgwatch&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>Roll out the pgwatch configuration schema with <code>config init</code> command</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="w">    </span>pgwatch<span class="w"> </span>--sources<span class="o">=</span>postgresql://pgwatch:xyz@localhost/pgwatch<span class="w"> </span>config<span class="w"> </span>init
</span></code></pre></div>
<p>This command will create the necessary tables for both monitored sources 
and metrics definitions. Also, it will populate metrics definitions 
with built-in metrics.</p>
</li>
<li>
<p>If for any reasons you want to have different databases for monitored 
    sources and metrics definitions, you can specify the metrics database 
    with the <code>--metrics</code> flag separately</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="w">    </span>pgwatch<span class="w"> </span>--metrics<span class="o">=</span>postgresql://pgwatch:xyz@localhost/pgwatch_metrics<span class="w"> </span>config<span class="w"> </span>init
</span></code></pre></div>
<p>or in the same command</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">    </span>pgwatch<span class="w"> </span>--sources<span class="o">=</span>postgresql://pgwatch:xyz@localhost/pgwatch<span class="w"> </span>--metrics<span class="o">=</span>postgresql://pgwatch:xyz@localhost/metrics<span class="w"> </span>config<span class="w"> </span>init
</span></code></pre></div>
</li>
</ol>
<h3 id="init-yaml-configuration-files-optional">Init YAML configuration files (optional)</h3>
<p>If you want to use the YAML file based configuration, you can bootstrap 
the configuration files with the following steps:</p>
<ol>
<li>
<p>Edit the <code>/etc/pgwatch/sample.sources.yaml</code> file to specify the hosts you want 
    to monitor and with which metrics/aggressiveness.</p>
</li>
<li>
<p>Save the file as <code>/etc/pgwatch/sources.yaml</code> or any other name you prefer.</p>
</li>
<li>
<p>Optionally edit the <code>/etc/pgwatch/metrics.yaml</code> file to specify the metrics 
    you want to change. Don't do anything if you are happy with the default metrics!</p>
</li>
</ol>
<h3 id="bootstrap-the-measurements-storage-aka-postgres-sink">Bootstrap the measurements storage aka Postgres sink</h3>
<p>pgwatch can send measruments into various sinks, like Postgres, Prometheus, JSON, RPC.
At least one is required, but you can use multiple sinks at the same time.</p>
<p>Create a dedicated database for storing metrics and a user to "own" the metrics schema</p>
<p>Here again default scripts expect a role named <code>pgwatch</code> but
can be anything if to adjust the scripts.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">    </span>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;create database measurements owner pgwatch&quot;</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Default retention for Postgres storage is 2 weeks!
To change, use the <code>--retention / PW_RETENTION</code>
gatherer parameter.</p>
</div>
<h2 id="prepare-the-to-be-monitored-sources">Prepare the "to-be-monitored" sources</h2>
<p>As a minimum we need a plain unprivileged login user. Better though
is to grant the user also the <code>pg_monitor</code> 
<a href="https://www.postgresql.org/docs/current/predefined-roles.html">system role</a>. 
Superuser privileges should be normally avoided for obvious
reasons of course, but for initial testing in safe environments it
can make the initial preparation (automatic <em>helper</em> rollouts) a bit
easier still, given superuser privileges are later stripped.</p>
<p>To get most out of your metrics some <code>SECURITY DEFINER</code> wrappers
functions called "helpers" are recommended on the DB-s under
monitoring. See the detailed chapter on the "preparation" topic
<a href="preparing_databases.html">here</a> for more
details.</p>
<h2 id="configure-sources-to-be-monitored-and-metrics-with-intervals">Configure sources to be monitored and metrics with intervals</h2>
<ul>
<li>From the Web UI</li>
<li>Via the REST API</li>
<li>Via direct inserts into the сonfiguration database <code>pgwatch.monitored_db</code> table if you set up the central configuration database</li>
<li>Via the YAML files if you set up the YAML based configuration</li>
</ul>
<h2 id="start-the-pgwatch-metrics-collection-agent">Start the pgwatch metrics collection agent</h2>
<p>The gatherer has quite some parameters (use the <code>--help</code> flag
to show them all), but simplest form would be:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>pgwatch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span>--sources<span class="o">=</span>postgresql://pgwatch:xyz@localhost/pgwatch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span>--sink<span class="o">=</span>postgresql://pgwatch@localhost/measurements
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code>--metrics</code> flag is not specified, pgwatch will assume that
metrics are stored in the same database as the sources. 
If not metric definitions are found in the database, pgwatch will
use the built-in metrics.</p>
</div>
<p>In case of a separate metrics definition database:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>pgwatch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span>--sources<span class="o">=</span>postgresql://pgwatch:xyz@localhost/pgwatch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span>--metrics<span class="o">=</span>postgresql://pgwatch:xyz@localhost/metrics<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span>--sink<span class="o">=</span>postgresql://pgwatch@localhost/measurements
</span></code></pre></div>
<p>You are free to mix datasbase and file configurations as you want.
Try this command for database configured sources and file configured metrics:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>pgwatch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span>--sources<span class="o">=</span>postgresql://pgwatch:xyz@localhost/pgwatch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span>--metrics<span class="o">=</span>/etc/pgwatch/metrics<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span>--sink<span class="o">=</span>postgresql://pgwatch@localhost/measurements
</span></code></pre></div>
<p>Or go completely with file configurations:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>pgwatch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span>--sources<span class="o">=</span>/etc/pgwatch/sources.yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span>--metrics<span class="o">=</span>/etc/pgwatch/metrics.yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span>--sink<span class="o">=</span>postgresql://pgwatch@localhost/measurements
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code>--metrics</code> flag is not specified for YAML file configuration, 
pgwatch will use the built-in metrics automatically.</p>
</div>
<h2 id="monitor-the-console-or-log-output-for-any-problems">Monitor the console or log output for any problems</h2>
<p>If you see metrics trickling into the <code>measurements</code>
database (metric names are mapped to table names and tables are
auto-created), then congratulations - the deployment is working!
When using some more aggressive <em>preset metrics config</em> then
there are usually still some errors though, due to the fact that
some more extensions or privileges are missing on the monitored
database side. See the according chapter
<a href="preparing_databases.html">here</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use <code>--log-level=debug</code> to get more verbose logging
in case of problems. </p>
</div>
<h2 id="install-grafana">Install Grafana</h2>
<ol>
<li>
<p>Create a Postgres database to hold Grafana internal config, like
    dashboards etc.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;create user pgwatch_grafana password &#39;xyz&#39;&quot;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;create database pgwatch_grafana owner pgwatch_grafana&quot;</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Theoretically it's not absolutely required to use Postgres for
storing Grafana internal settings and dashboards, but doing so 
one can also do remote backups of the Grafana configuration easily.</p>
</div>
</li>
<li>
<p>Follow the <a href="https://grafana.com/docs/grafana/latest/installation/">instructions</a> to install Grafana.
    Default Grafana port: 3000</p>
</li>
<li>
<p>Configure Grafana config to use our <code>pgwatch_grafana</code> DB.
    Put something like below in the <code>[database]</code> section of
    <code>/etc/grafana/grafana.ini</code></p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">[database]</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">postgres</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="na">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">my-postgres-db:5432</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">pgwatch_grafana</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="na">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">pgwatch_grafana</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="na">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">xyz</span>
</span></code></pre></div>
<p>Taking a look at <code>[server]</code>, <code>[security]</code> and <code>[auth*]</code>
sections is also recommended.</p>
</li>
<li>
<p>Set up the <code>measurements</code> database as the default datasource.</p>
<p>Copy <code>grafana/postgres_datasource.yml</code> file to
<code>/etc/grafana/provisioning/datasources/</code> and adjust the
connection string and other settings as needed.</p>
</li>
<li>
<p>Add pgwatch predefined dashboards to Grafana</p>
<p>Copy <code>/grafana/postgres_dashboard.yml</code> file to
<code>/etc/grafana/provisioning/dashboards/</code>.</p>
<p>Then copy the actual dashboard JSON files from the
<code>/grafana/postgres/v10</code> folder to <code>/var/lib/grafana/dashboards/</code>.
Here the <code>postgres</code> part of the path specifies the database type and
the <code>v10</code> part specifies the version of the Grafana.</p>
<p>If you will use Prometheus as a sink, then you should copy the
<code>/grafana/prometheus/v10</code> folder instead. Or use your own
dashboards.</p>
<p>Of course, one can also import the dashboards manually via the
Grafana UI.</p>
</li>
<li>
<p>Optionally install Grafana plugins</p>
<p>Currently, one pre-configured dashboard (Biggest relations
treemap) uses an extra plugin. If you're planning to use that 
dashboard, then run the following command to install the plugin:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>grafana-cli<span class="w"> </span>plugins<span class="w"> </span>install<span class="w"> </span>marcusolsson-treemap-panel
</span></code></pre></div>
</li>
<li>
<p>Start discovering the preset dashboards</p>
<p>If the previous step of launching pgwatch daemon succeeded, and
it was more than some minutes ago, one should already see some
graphs on dashboards like "DB overview" or "DB overview
Unprivileged / Developer mode" for example.</p>
</li>
</ol>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="docker_installation.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Docker Installation">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Docker Installation
              </div>
            </div>
          </a>
        
        
          
          <a href="preparing_databases.html" class="md-footer__link md-footer__link--next" aria-label="Next: Preparing Databases">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Preparing Databases
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Made by and for PostgreSQL lovers! 🐘❤️
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["announce.dismiss", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.edit", "navigation.footer", "navigation.instant", "navigation.tracking", "navigation.tabs", "content.tabs.link"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>